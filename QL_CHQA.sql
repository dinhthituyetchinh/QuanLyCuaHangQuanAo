
CREATE DATABASE QL_CUAHANGQUANAO

USE QL_CUAHANGQUANAO
GO

--- MAQUYEN: Q001
--- TENQUYEN: BOSS

CREATE TABLE QUYEN
(
	MAQUYEN INT IDENTITY(1, 1),
	TENQUYEN VARCHAR(10),
	CONSTRAINT PK_QUYEN PRIMARY KEY (MAQUYEN)
)
ALTER TABLE QUYEN
ADD CONSTRAINT DF_TENQUYEN DEFAULT ('Admin') FOR TENQUYEN


INSERT INTO QUYEN
VALUES
('Admin'),
('Boss');

SELECT * FROM QUYEN

CREATE TABLE NGUOIDUNG
(
USERNAME CHAR(10) NOT NULL, 
PASSWORD CHAR(10),
HOTEN NVARCHAR (50),
DIACHI NVARCHAR (100),
MAQUYEN INT NOT NULL,
HINH NVARCHAR(MAX),
CONSTRAINT PK_DN PRIMARY KEY (USERNAME),
CONSTRAINT FK_DN_QUYEN FOREIGN KEY(MAQUYEN) REFERENCES QUYEN(MAQUYEN)
)


INSERT INTO NGUOIDUNG
VALUES
( 'NV01', 'van12312', N'Nguyễn Văn', N'Phú Yên', 1, NULL),
( 'NV02', 'dttc2004', N'Đinh Thị Tuyết Chinh', N'Gia Lai', 2, NULL),
( 'NV03', 'anvy111', N'Nguyễn Thường An Vy', N'TPHCM', 1, NULL),
( 'NV04', 'dttc2004', N'Đinh Thị Tuyết Chinh', N'Gia Lai', 1, NULL)

SELECT * FROM NGUOIDUNG

-- CHATLIEU(HAY ĐƯỢC GỌI LÀ DANH MỤC SP)
---- MACHATLIEU: CL1
---- TENCHATLIEU: LEN

CREATE TABLE CHATLIEU 
(
MACHATLIEU CHAR(10) NOT NULL,
TENCHATLIEU NVARCHAR(50),
CONSTRAINT PK_CHATLIEU PRIMARY KEY (MACHATLIEU)
)

INSERT INTO CHATLIEU
VALUES
('CL1', N'Len'),
('CL2', N'Jeans'),
('CL3', N'Thun'),
('CL4', N'Lanh'),
('CL5', N'KaKi'),
('CL6', N'Voan'),
('CL7', N'Nỉ');

SELECT * FROM CHATLIEU
---- MAMAU: 1
---- TENMAU: MÀU ĐEN
CREATE TABLE MAUSAC
(
MAMAU INT IDENTITY(1, 1) NOT NULL,
TENMAU NVARCHAR(50),
CONSTRAINT PK_MAUSAC PRIMARY KEY (MAMAU)
)

INSERT INTO MAUSAC
VALUES
(N'Màu Đen'),
(N'Màu Trắng'),
(N'Màu Đỏ'),
(N'Màu Tím'),
(N'Màu Cam'),
(N'Màu Vàng'),
(N'Màu Xanh Lá Mạ'),
(N'Màu Xanh Lục'),
(N'Màu Xám'),
(N'Màu Hồng Nhạt'),
(N'Màu Hồng Đậm'),
(N'Màu Xanh Da Trời'),
(N'Màu Xanh Nước Biển');

SELECT * FROM MAUSAC

---- MASP: SP001
---- TENSP: ÁO LEN
---- MACHATLIEU: CL1
---- MAMAU: 1
---- KICHTHUOC: S
---- DONGIANHAP: 250000
---- DONGIABAN: 287000
---- SOLUONGTONKHO: 500
---- MOTA: Áo len hàng nhập Quảng Châu, ...
---- HINH: Chuỗi để hiển thị hình ảnh


CREATE TABLE SANPHAM
(
MASP CHAR(10) NOT NULL, 
TENSP NVARCHAR(100), 
KICHTHUOC CHAR(3),
SOLUONG INT, 
DONGIANHAP FLOAT,
DONGIABAN FLOAT,
MOTA NVARCHAR (500),
HINH NVARCHAR(500),
CONSTRAINT PK_SP PRIMARY KEY (MASP)
)

ALTER TABLE SANPHAM 
ADD CONSTRAINT CHK_SL CHECK(SOLUONG > 0),
CONSTRAINT CHK_DG_NHAP CHECK(DONGIANHAP > 0),
CONSTRAINT CHK_DG_BAN CHECK(DONGIABAN > 0)


INSERT INTO SANPHAM
VALUES
('SP001', N'Áo len', 'S', 100, 250000, 287000, '', 'AoLenCL1.jpg'),
('SP002', N'Chân váy jeans dáng dài', 'S', 80, 150000, 188000, N'Chân váy jeans dáng dài xẻ tà, hàng Quảng Châu chất lượng', 'chan-vay-jeans-dang-dai-1.jpg'),
('SP003', N'Áo thun trắng dễ thương', 'XL', 100, 125000, 159000, 'Hoạ tiết hình dễ thương', 'AoLenCL1.jpg'),
('SP004', N'Quần tây nam 1', 'S', 100, 250000, 295000, '', 'quan-tay-nam-1.jpg');


SELECT * FROM SANPHAM

-- CTSP
CREATE TABLE SANPHAM_MAU_CHATLIEU
(
MASP CHAR(10) NOT NULL,
MAMAU INT,
MACHATLIEU CHAR(10) NOT NULL,
CONSTRAINT PK_SP_MAU_CL PRIMARY KEY (MASP, MAMAU, MACHATLIEU),
CONSTRAINT FK_SP_MAU_CL_SP FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP),
CONSTRAINT FK_SP_MAU_CL_MS FOREIGN KEY(MAMAU) REFERENCES MAUSAC(MAMAU),
CONSTRAINT FK_SP_MAU_CL_CHATLIEU FOREIGN KEY(MACHATLIEU) REFERENCES CHATLIEU(MACHATLIEU)
)

INSERT INTO SANPHAM_MAU_CHATLIEU
VALUES
('SP001', 1, 'CL1'),
('SP002', 13, 'CL2'),
('SP003', 2, 'CL3'),
('SP004', 1, 'CL1');

SELECT * FROM SANPHAM_MAU_CHATLIEU

CREATE TABLE KHACHHANG
(
	SDT CHAR(10) NOT NULL,
	HOTENKH NVARCHAR(50),
	DIACHI NVARCHAR(100),
	CONSTRAINT PK_KH PRIMARY KEY (SDT)
)

INSERT INTO KHACHHANG
VALUES
('0389458294', N'Nguyễn Văn Nam', N'TPHCM'),
('0267589157', N'Nguyễn An', N'TPHCM'),
('0679826459', N'Trần Thị Vân', N'TPHCM'),
('0773845756', N'Lê Ngọc Chi', N'TPHCM');

--- MAHD: HD001
--- NGAYLAPHD
--- MASP: SP001
--- MAHD: HD002
--- NGAYLAPHD
--- MASP: SP001
CREATE TABLE HOADON
(
	MAHD CHAR(10) NOT NULL, 
	NGAYLAPHD DATE, 
	USERNAME CHAR(10),
	SDT CHAR(10) NOT NULL, 
	CONSTRAINT PK_HD PRIMARY KEY(MAHD),
	CONSTRAINT FK_HD_KH FOREIGN KEY(SDT) REFERENCES KHACHHANG(SDT),
	CONSTRAINT FK_HD_ND FOREIGN KEY(USERNAME) REFERENCES NGUOIDUNG(USERNAME)
);

SET DATEFORMAT DMY
INSERT INTO HOADON
VALUES
('HD001', '12/11/2023', 'NV01', '0389458294'),
('HD002', '15/11/2023', 'NV01', '0267589157'),
('HD003', '16/11/2023', 'NV01', '0389458294'),
('HD004', '18/11/2023', 'NV03', '0679826459'),
('HD005', '19/11/2023', 'NV03', '0773845756'),
('HD006', '19/11/2023', 'NV03', '0389458294'),
('HD007', '20/11/2023', 'NV04', '0773845756'),
('HD008', '20/11/2023', 'NV04', '0679826459');

SELECT * FROM HOADON

CREATE TABLE CHITIETHD
(
MAHD CHAR(10) NOT NULL, 
MASP CHAR (10),
MANVBH CHAR(10) NOT NULL,  
SOLUONGDAMUA INT, 
DONGIA MONEY,
TONGTIEN MONEY, 
CONSTRAINT PK_CTHD PRIMARY KEY (MAHD, MASP),
CONSTRAINT FK_CTHD_HD FOREIGN KEY(MAHD) REFERENCES HOADON(MAHD),
CONSTRAINT FK_CTHD_SP FOREIGN KEY(MASP) REFERENCES SANPHAM(MASP),
CONSTRAINT FK_CTHD_ND FOREIGN KEY(MANVBH) REFERENCES NGUOIDUNG(USERNAME)
)


INSERT INTO CHITIETHD
VALUES
('HD001', 'SP002', 'NV03', 1, 150000, 150000)

SELECT * FROM CHITIETHD